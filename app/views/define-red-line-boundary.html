{% extends "layouts/map-layout.html" %}
{% from "govuk/components/back-link/macro.njk" import govukBackLink %}

{% set pageName="Define Red Line Boundary" %}

{% block pageTitle %}
  Define Red Line Boundary - GOV.UK Prototype Kit
{% endblock %}

{% block backLink %}
  <div class="map-page-header">
    <div class="map-page-header__back-link">
      {{ govukBackLink({
        href: "/",
        text: "Back"
      }) }}
    </div>
    <h1 class="map-page-header__title govuk-heading-l">Define red line boundary</h1>
  </div>
{% endblock %}

{% block mapAttributes %}{% endblock %}

{% block mapAreaDisplay %}
  <div class="map-area-display__title">Boundary Area</div>
  <div class="map-area-display__value" id="area-value">--</div>
  <div class="map-area-display__unit">hectares</div>
{% endblock %}

{% block helpContent %}
  <p class="govuk-body">You can define your red-line boundary using two methods:</p>
  
  <h3 class="govuk-heading-s govuk-!-margin-top-4">Option 1: Fill Polygon (recommended)</h3>
  <p class="govuk-body">Select existing OS map features like fields, land parcels, or sites:</p>
  <ol class="govuk-list govuk-list--number">
    <li><strong>Zoom in to at least zoom level 14</strong> - Watch the zoom indicator turn green</li>
    <li>Click <strong>"Fill boundary"</strong> to start selection mode</li>
    <li><strong>Click on a field or land area</strong> - it will highlight in blue when selected</li>
    <li>Click on <strong>adjacent areas</strong> to add them to your selection (they must be neighbouring)</li>
    <li>Click a selected polygon again to <strong>deselect</strong> it</li>
    <li>Click <strong>"Confirm selection"</strong> when you're happy with the boundary</li>
  </ol>
  <div class="govuk-inset-text">
    <strong>Note:</strong> All selected polygons must be adjacent (touching). You cannot select disconnected areas.
  </div>

  <h3 class="govuk-heading-s govuk-!-margin-top-4">Option 2: Draw Polygon</h3>
  <p class="govuk-body">Manually draw your boundary with intelligent snapping:</p>
  <ol class="govuk-list govuk-list--number">
    <li><strong>Zoom in to at least zoom level 14</strong> - Watch the zoom indicator turn green</li>
    <li>Click <strong>"Draw boundary"</strong> to start drawing mode</li>
    <li>Move your mouse near features - the cursor will snap to edges and corners</li>
    <li>Click to place each vertex</li>
    <li>Hover over the first vertex and click to <strong>close the polygon</strong></li>
  </ol>

  <h3 class="govuk-heading-s govuk-!-margin-top-4">Editing a completed polygon:</h3>
  <ol class="govuk-list govuk-list--number">
    <li><strong>Hover over any vertex</strong> - it will enlarge slightly</li>
    <li><strong>Click and drag</strong> the vertex to a new position</li>
    <li>To <strong>add a new vertex</strong>, hover over the polygon edge - a white circle appears</li>
    <li><strong>Click the white circle</strong> to insert a new vertex</li>
  </ol>

  <div class="govuk-inset-text govuk-!-margin-top-4">
    <strong>Visual feedback:</strong>
    <ul class="govuk-list govuk-list--bullet govuk-!-margin-top-2">
      <li><strong style="color: #1d70b8;">Blue highlight</strong> = selected polygon (Fill mode)</li>
      <li><strong style="color: #ff8c00;">Orange circle</strong> = snapped to a feature (Draw mode)</li>
      <li><strong style="color: #ff0000;">Red circle</strong> = hover over first vertex to close</li>
    </ul>
  </div>
{% endblock %}

{% block mapScript %}
  <script src="/public/javascripts/map-red-line-boundary.js"></script>
{% endblock %}
